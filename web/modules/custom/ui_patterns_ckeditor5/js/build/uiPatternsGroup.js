!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.CKEditor5=e():(t.CKEditor5=t.CKEditor5||{},t.CKEditor5.uiPatternsGroup=e())}(self,(()=>(()=>{var t={"ckeditor5/src/core.js":(t,e,o)=>{t.exports=o("dll-reference CKEditor5.dll")("./src/core.js")},"ckeditor5/src/ui.js":(t,e,o)=>{t.exports=o("dll-reference CKEditor5.dll")("./src/ui.js")},"ckeditor5/src/utils.js":(t,e,o)=>{t.exports=o("dll-reference CKEditor5.dll")("./src/utils.js")},"dll-reference CKEditor5.dll":t=>{"use strict";t.exports=CKEditor5.dll}},e={};function o(n){var s=e[n];if(void 0!==s)return s.exports;var r=e[n]={exports:{}};return t[n](r,r.exports,o),r.exports}o.d=(t,e)=>{for(var n in e)o.o(e,n)&&!o.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})},o.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e);var n={};return(()=>{"use strict";o.d(n,{default:()=>u});var t=o("ckeditor5/src/core.js"),e=o("ckeditor5/src/utils.js");class s extends t.Command{constructor(t,e){super(t),this.set("value",[]),this.set("enabledPatterns",[]),this._patternDefinitions=e||t.config.get("UiPatternsGroup.options"),console.log(e,"patternDefinitions yass")}refresh(){const t=this.editor.model,o=t.document.selection,n=this.editor.plugins.get("GeneralHtmlSupport"),s=this.editor.plugins.get("DataSchema"),i=new Set,c=new Set,a=(0,e.first)(o.getSelectedBlocks());if(a){const e=a.getAncestors({includeSelf:!0,parentFirst:!0});for(const o of e){if(t.schema.isLimit(o))break;const e=s.getDefinitionsForModel(o.name).find((t=>t.model==o.name&&1==t.isBlock));if(void 0===e)continue;const a=n.getGhsAttributeNameForElement(e.view);if(t.schema.checkAttribute(o,a))for(const t of this._patternDefinitions){c.add(t.name);r(o.getAttribute(a),t.classes)&&i.add(t.name)}}}this.enabledPatterns=Array.from(c).sort(),this.isEnabled=this.enabledPatterns.length>0,this.value=this.isEnabled?Array.from(i).sort():[]}execute({patternName:t}){console.log(t,"patternName");const e=this.editor.model,o=e.document.selection,n=(this.editor.plugins.get("GeneralHtmlSupport"),this.editor.plugins.get("DataSchema"));console.log(n,"dataSchema"),console.log(this._patternDefinitions,"this._patternDefinitions yass");const s=this._patternDefinitions.find((e=>e.name.includes(t)));console.log(s,"definition");const r=!this.value.includes(s.name);if(!s)return console.log("hello"),void console.error(`Pattern definition not found for ${t}`);e.change((()=>{const s=i(o.getSelectedBlocks(),e.schema);for(const c of s){n.getDefinitionsForModel(c.name).find((t=>t.model===c.name&&!0===t.isBlock))&&(r&&Promise.all([fetch("/api/assets").then((t=>t.json())),fetch("/api/ui-patterns").then((t=>t.json())),fetch(`/api/ui-patterns/${t}/content`).then((t=>t.json()))]).then((([n,s,r])=>{console.log(n,"assetRessources");const c=Array.isArray(n.cssFiles)?n.cssFiles:[];console.log(c,"cssLinks");const a=this.editor;c.forEach((t=>{const e=document.createElement("link");e.rel="stylesheet",e.href="/"+t,document.head.appendChild(e)}));(Array.isArray(n.jsFiles)?n.jsFiles:[]).forEach((t=>{const e=document.createElement("script");e.src="/"+t,document.head.appendChild(e)}));const l=s.find((e=>e.includes(t)));if(console.log(l,"patternPath"),!l)throw console.log("Pattern not found"),new Error(`Pattern ${t} not found`);let d=r.content;d=d.replace(/<button\b([^>]*)>/g,"<span$1>"),d=d.replace(/<\/button>/g,"</span>"),a.setData(d,!0),console.log(a.setData(d,!0),"editorInstance.setData(content, true)");const u=i(o.getSelectedBlocks(),e.schema);for(const t of u);})).catch((t=>console.error(t))))}}))}}function r(t,e){return!(!t||!t.classes)&&e.every((e=>t.classes.includes(e)))}function i(t,e){const o=new Set;for(const n of t){const t=n.getAncestors({includeSelf:!0,parentFirst:!0});for(const n of t){if(e.isLimit(n))break;o.add(n)}}return console.log(o,"blocks"),o}class c extends t.Plugin{static get pluginName(){return"UiPatternsGroupEditing"}static get requires(){return["GeneralHtmlSupport","DataSchema"]}init(){const t=this.editor,e=function(t=[]){const e=[];for(const o of t)o.options.forEach((t=>{const n=t.name;t.name=`${o.id}:${n}`,t.template=`${o.template}:${n}`,e.push({...t})}));return e}(t.config.get("UiPatternsGroup.options"));console.log(e,"normalizedPatternDefinitions"),t.commands.add("UiPatternsGroup",new s(t,e)),this._defineSchema()}_defineSchema(){const t=this.editor.model.schema,e=this.editor.plugins.get("GeneralHtmlSupport"),o=this.editor.plugins.get("DataSchema");for(const n in t.getDefinitions()){const s=o.getDefinitionsForModel(n).find((t=>t.model==n&&1==t.isBlock));if(void 0===s)continue;const r=e.getGhsAttributeNameForElement(s.view);t.setAttributeProperties(r,{isFormatting:!0})}t.setAttributeProperties("htmlAttributes",{isFormatting:!0})}}var a=o("ckeditor5/src/ui.js");class l extends t.Plugin{static get pluginName(){return"UiPatternsGroupUI"}init(){const t=this.editor,o=t.ui.componentFactory,n=Drupal.t,s=t.config.get("UiPatternsGroup.options");console.log(s,"options");const r=new e.Collection;s.forEach((e=>{const o=e.id,n={type:"button",model:new a.Model({commandName:"UiPatternsGroup",commandParam:o,label:e.label,withText:!0})},s=t.commands.get("UiPatternsGroup");n.model.bind("isOn").to(s,"value",(t=>t===o)),r.add(n)}));const i=(0,a.createDropdown)(t.locale);(0,a.addListToDropdown)(i,r),i.buttonView.set({label:n("Patterns (group)"),withText:!0,tooltip:!0});const c=t.commands.get("UiPatternsGroup");i.bind("class").to(c,"value",(t=>{const e=["ck-ui-patterns-group-dropdown"];return null!==t&&e.push("ck-ui-patterns-group-dropdown-active"),e.join(" ")})),this.listenTo(i,"execute",(e=>{t.execute(e.source.commandName,{patternName:e.source.commandParam}),t.editing.view.focus()})),o.add("UiPatternsGroup",(()=>i))}}class d extends t.Plugin{static get pluginName(){return"UiPatternsGroup"}static get requires(){return[c,l]}}const u={UiPatternsGroup:d}})(),n=n.default})()));